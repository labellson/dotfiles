'use strict';var mF={TAB:0,EC:1,RP:2},nF=function(a){Tg("MediaRouter.WebRtc.Start.Success",a,mF)};var oF=function(a,b){uh.call(this,b);this.Ea=a;this.Bg=new zc;this.Lc=xg.$r(b.id);this.va=new zc;this.bd=!1;this.Dd=null;this.vy=!1;this.$c=this.yf=null;this.Mp();this.uB();this.Bb(new xh("GET_TURN_CREDENTIALS"))};ja(oF,uh);d=oF.prototype;
d.start=function(a){var b=this;return this.Bg.promise.then(function(c){if(c.Es())return Promise.reject(new Wg("Mirroring already started"));if(b.Dd)return Promise.reject(new Wg("Session permanently stopped"));b.yf=new Kg("MediaRouter.WebRtc.Session.Launch");c.addStream(a);c.start();return b.va.promise})};
d.stop=function(){var a=this;this.va.reject(new Wg("Session stop requested."));this.$c&&(this.$c.end(),this.$c=null);if(this.Dd)return this.Dd;this.vy=this.bd=!1;this.yf=null;return this.Dd=this.Bg.promise.then(function(a){a.stop()}).then(function(){return a.Lc.Pa()}).catch(function(b){a.Lc.Pa();throw b;})};
d.Mp=function(){var a=this;this.Lc.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.Bg.resolve(new Bh(a.Ya.id,b.data.credentials));break;case "ANSWER":a.Bg.promise.then(function(a){a.setRemoteDescription(b.data)});break;case "KNOCK_ANSWER":a.vy=!0;a.Bg.promise.then(function(a){a.setRemoteDescription(b.data)});break;case "STOP":a.va.reject(new Wg("Stop signal received"));a.stop();break;default:throw new Wg("Unknown message type: "+b.type);
}}};d.uB=function(){var a=this;this.Bg.promise.then(function(b){b.YM(function(b){a.Bb(new xh("OFFER",new zh(b,a.Ea,Ah)))});b.XM(function(b){a.Bb(yh(b))});b.WM(function(){a.bd=!0;a.Bb(new xh("SESSION_START_SUCCESS"));!a.vy&&a.yf&&a.yf.end();a.yf=null;a.$c=new Pg("MediaRouter.WebRtc.Session.Length");a.va.resolve(a)});b.UM(function(){a.Bb(new xh("SESSION_END"))});b.VM(function(b){a.bd||a.va.reject(b);a.Bb(new xh("SESSION_FAILURE"))})})};d.Bb=function(a){this.Lc.sendMessage(a,pF)};var pF={channelType:"cloud"};var qF=function(){sh.call(this,"webrtc")};ja(qF,sh);d=qF.prototype;d.jr=function(a,b){return new oF(a,b)};d.Nt=function(){nF(0)};d.Jt=function(){nF(1)};d.jA=function(){nF(2)};d.Kt=function(){Sg("MediaRouter.WebRtc.Session.End")};d.Lt=function(a){Tg("MediaRouter.WebRtc.Start.Failure",a,Vg)};d.Mt=function(){Sg("MediaRouter.WebRtc.Stream.End")};var rF=new qF;qh("mr.mirror.webrtc.WebRtcService",rF);
