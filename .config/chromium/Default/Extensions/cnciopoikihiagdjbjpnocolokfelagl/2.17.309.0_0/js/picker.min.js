!function(a,b){!function(){function a(a){var c=!1;return function(){if(c)throw new Error("Callback was already called.");c=!0,a.apply(b,arguments)}}var b,c,d={};b=this,null!=b&&(c=b.async),d.noConflict=function(){return b.async=c,d};var e=Object.prototype.toString,f=Array.isArray||function(a){return"[object Array]"===e.call(a)},g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof process&&process.nextTick?(d.nextTick=process.nextTick,"undefined"!=typeof setImmediate?d.setImmediate=function(a){setImmediate(a)}:d.setImmediate=d.nextTick):"function"==typeof setImmediate?(d.nextTick=function(a){setImmediate(a)},d.setImmediate=d.nextTick):(d.nextTick=function(a){setTimeout(a,0)},d.setImmediate=d.nextTick),d.each=function(b,c,d){function e(a){a?(d(a),d=function(){}):(f+=1,f>=b.length&&d())}if(d=d||function(){},!b.length)return d();var f=0;g(b,function(b){c(b,a(e))})},d.forEach=d.each,d.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},d.forEachSeries=d.eachSeries,d.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},d.forEachLimit=d.eachLimit;var k=function(a){return function(b,c,d){if(d=d||function(){},!b.length||a<=0)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;g<a&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.each].concat(b))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.eachSeries].concat(b))}},o=function(a,b,c,d){if(b=h(b,function(a,b){return{index:b,value:a}}),d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})};d.map=l(o),d.mapSeries=n(o),d.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};d.reduce=function(a,b,c,e){d.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){e(a,b)})},d.inject=d.reduce,d.foldl=d.reduce,d.reduceRight=function(a,b,c,e){var f=h(a,function(a){return a}).reverse();d.reduce(f,b,c,e)},d.foldr=d.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.filter=l(q),d.filterSeries=n(q),d.select=d.filter,d.selectSeries=d.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.reject=l(r),d.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};d.detect=l(s),d.detectSeries=n(s),d.some=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(a){c(!1)})},d.any=d.some,d.every=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(a){c(!0)})},d.all=d.every,d.sortBy=function(a,b,c){d.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0};c(null,h(b.sort(d),function(a){return a.value}))})},d.auto=function(a,b){b=b||function(){};var c=j(a),e=c.length;if(!e)return b();var h={},k=[],l=function(a){k.unshift(a)},m=function(a){for(var b=0;b<k.length;b+=1)if(k[b]===a)return void k.splice(b,1)},n=function(){e--,g(k.slice(0),function(a){a()})};l(function(){if(!e){var a=b;b=function(){},a(null,h)}}),g(c,function(c){var e=f(a[c])?a[c]:[a[c]],k=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var f={};g(j(h),function(a){f[a]=h[a]}),f[c]=e,b(a,f),b=function(){}}else h[c]=e,d.setImmediate(n)},o=e.slice(0,Math.abs(e.length-1))||[],p=function(){return i(o,function(a,b){return a&&h.hasOwnProperty(b)},!0)&&!h.hasOwnProperty(c)};if(p())e[e.length-1](k,h);else{var q=function(){p()&&(m(q),e[e.length-1](k,h))};l(q)}})},d.retry=function(a,b,c){var e=5,f=[];"function"==typeof a&&(c=b,b=a,a=e),a=parseInt(a,10)||e;var g=function(e,g){for(var h=function(a,b){return function(c){a(function(a,d){c(!a||b,{err:a,result:d})},g)}};a;)f.push(h(b,!(a-=1)));d.series(f,function(a,b){b=b[b.length-1],(e||c)(b.err,b.result)})};return c?g():g},d.waterfall=function(a,b){if(b=b||function(){},!f(a)){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var e=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=a.next();g?f.push(e(g)):f.push(b),d.setImmediate(function(){a.apply(null,f)})}}};e(d.iterator(a))()};var t=function(a,b,c){if(c=c||function(){},f(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};d.parallel=function(a,b){t({map:d.map,each:d.each},a,b)},d.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},d.series=function(a,b){if(b=b||function(){},f(a))d.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};d.eachSeries(j(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},d.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},d.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};d.concat=l(u),d.concatSeries=n(u),d.whilst=function(a,b,c){a()?b(function(e){return e?c(e):void d.whilst(a,b,c)}):c()},d.doWhilst=function(a,b,c){a(function(e){if(e)return c(e);var f=Array.prototype.slice.call(arguments,1);b.apply(null,f)?d.doWhilst(a,b,c):c()})},d.until=function(a,b,c){a()?c():b(function(e){return e?c(e):void d.until(a,b,c)})},d.doUntil=function(a,b,c){a(function(e){if(e)return c(e);var f=Array.prototype.slice.call(arguments,1);b.apply(null,f)?c():d.doUntil(a,b,c)})},d.queue=function(b,c){function e(a,b,c,e){return a.started||(a.started=!0),f(b)||(b=[b]),0==b.length?d.setImmediate(function(){a.drain&&a.drain()}):void g(b,function(b){var f={data:b,callback:"function"==typeof e?e:null};c?a.tasks.unshift(f):a.tasks.push(f),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),d.setImmediate(a.process)})}void 0===c&&(c=1);var h=0,i={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){e(i,a,!1,b)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(a,b){e(i,a,!0,b)},process:function(){if(!i.paused&&h<i.concurrency&&i.tasks.length){var c=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),h+=1;var d=function(){h-=1,c.callback&&c.callback.apply(c,arguments),i.drain&&i.tasks.length+h===0&&i.drain(),i.process()},e=a(d);b(c.data,e)}},length:function(){return i.tasks.length},running:function(){return h},idle:function(){return i.tasks.length+h===0},pause:function(){i.paused!==!0&&(i.paused=!0,i.process())},resume:function(){i.paused!==!1&&(i.paused=!1,i.process())}};return i},d.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function e(a,b,c){for(var d=-1,e=a.length-1;d<e;){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function h(a,b,h,i){return a.started||(a.started=!0),f(b)||(b=[b]),0==b.length?d.setImmediate(function(){a.drain&&a.drain()}):void g(b,function(b){var f={data:b,priority:h,callback:"function"==typeof i?i:null};a.tasks.splice(e(a.tasks,f,c)+1,0,f),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),d.setImmediate(a.process)})}var i=d.queue(a,b);return i.push=function(a,b,c){h(i,a,b,c)},delete i.unshift,i},d.cargo=function(a,b){var c=!1,e=[],i={tasks:e,payload:b,saturated:null,empty:null,drain:null,drained:!0,push:function(a,c){f(a)||(a=[a]),g(a,function(a){e.push({data:a,callback:"function"==typeof c?c:null}),i.drained=!1,i.saturated&&e.length===b&&i.saturated()}),d.setImmediate(i.process)},process:function d(){if(!c){if(0===e.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var f="number"==typeof b?e.splice(0,b):e.splice(0,e.length),j=h(f,function(a){return a.data});i.empty&&i.empty(),c=!0,a(j,function(){c=!1;var a=arguments;g(f,function(b){b.callback&&b.callback.apply(null,a)}),d()})}},length:function(){return e.length},running:function(){return c}};return i};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};d.log=v("log"),d.dir=v("dir"),d.memoize=function(a,b){var c={},e={};b=b||function(a){return a};var f=function(){var f=Array.prototype.slice.call(arguments),g=f.pop(),h=b.apply(null,f);h in c?d.nextTick(function(){g.apply(null,c[h])}):h in e?e[h].push(g):(e[h]=[g],a.apply(null,f.concat([function(){c[h]=arguments;var a=e[h];delete e[h];for(var b=0,d=a.length;b<d;b++)a[b].apply(null,arguments)}])))};return f.memo=c,f.unmemoized=a,f},d.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},d.times=function(a,b,c){for(var e=[],f=0;f<a;f++)e.push(f);return d.map(e,b,c)},d.timesSeries=function(a,b,c){for(var e=[],f=0;f<a;f++)e.push(f);return d.mapSeries(e,b,c)},d.seq=function(){var a=arguments;return function(){var b=this,c=Array.prototype.slice.call(arguments),e=c.pop();d.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){e.apply(b,[a].concat(c))})}},d.compose=function(){return d.seq.apply(null,Array.prototype.reverse.call(arguments))};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};d.applyEach=l(w),d.applyEachSeries=n(w),d.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define&&define.amd?define([],function(){return d}):b.async=d}(),function(){"use strict";function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,f=e.EventEmitter;d.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&b(e[d],c)===-1&&(e[d].push(f?c:{listener:c,once:!1}),this.emit("listenerAdded",a,c.listener||c,c.once||!1));return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)if(f.hasOwnProperty(e)&&(d=b(f[e],c),d!==-1))var c=f[e].splice(d,1);return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=f,a},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:e.EventEmitter=a}.call(this),function(b){var c=b.EventEmitter||require("lib/EventEmitter"),d=function(a){return c.call(this),d.instance?d.instance:(this._isBackground=a,this._cbList={},this._portList=[],this._initialize(),void(d.instance=this))};d.prototype=Object.create(c.prototype),d.prototype._initialize=function(){if(this._isBackground)a.runtime.onConnect.addListener(this._onPortConnect.bind(this));else{var b=a.runtime.connect();this._onPortConnect(b)}},d.prototype._onPortConnect=function(a){this._portList.push(a),a.onDisconnect.addListener(this._onPortDisconnect.bind(this,a)),a.onMessage.addListener(this._onMessage.bind(this)),this.emit("port-connected")},d.prototype._onPortDisconnect=function(a){this._portList.splice(this._portList.indexOf(a),1),this._isBackground||this._initialize()},d.prototype._onMessage=function(a){var b=a,c=b.args,d=b._cb,e=b.isCb;if(e){if(!this._cbList[d])return;return this._cbList[d].apply(null,c),void delete this._cbList[d]}if(d){var f=this,g=[].concat(c);g.push(function(){for(var a={args:[].slice.apply(arguments),_cb:d,isCb:!0},b=0;b<f._portList.length;b++){var c=f._portList[b];c.postMessage(a)}}),this.emit.apply(this,g)}else this.emit.apply(this,c)},d.prototype.send=d.prototype.postMessage=function(){var a=[].slice.apply(arguments),b=null;"function"==typeof a[a.length-1]&&(b=a.pop());var c={args:a};b&&(c._cb=Uuid.generate(),this._cbList[c._cb]=b);for(var d=0;d<this._portList.length;d++){var e=this._portList[d];e.postMessage(c)}},d.prototype._onError=function(){},d.prototype.postTo=function(){var a=[].slice.apply(arguments),b=null,c=a.shift();"function"==typeof a[a.length-1]&&(b=a.pop());var d={args:a,to:c};b&&(d._cb=Uuid.generate(),this._cbList[d._cb]=b),this.worker.port.postMessage(d)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=d:b.SuperWorker=d}(b);var c=function(){function a(a){d._superWorker.postMessage("FilePicker",a),b.close()}var d=this;this._superWorker=new SuperWorker((!1)),this._params=c._getQueryParameters(),this._openPicker(a)};c.prototype._openPicker=function(b){function c(){for(var c=[].slice.call(arguments),d=Array.isArray(c[0])?c[0]:c,e=[],f=0;f<d.length;++f)e.push(a.fileSystem.retainEntry(d[f]));b(e)}var d={type:this._params.directory&&"true"==this._params.directory?"openDirectory":"openFile",acceptsMultiple:this._params.multiple&&"true"==this._params.multiple,acceptsAllTypes:!0};this._params.accepts&&(d.accepts=JSON.parse(this._params.accepts)),b&&a.fileSystem.chooseEntry(d,c)},c._getQueryParameters=function(){var a={};if(b.location.search.length>1)for(var c,d=0,e=b.location.search.substr(1).split("&");d<e.length;d++)c=e[d].split("="),a[b.decodeURIComponent(c[0])]=c.length>1?b.decodeURIComponent(c[1]):"";return a},new c}(chrome,window);